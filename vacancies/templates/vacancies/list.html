{% extends 'base.html' %}
{% load static %}

{% block title %}Career Opportunities - EIP Ethiopia{% endblock %}

{% block meta_description %}Join our team! View current job vacancies and career opportunities at EIP Ethiopia. Make a difference through meaningful work.{% endblock %}

{% block page_title %}Career Opportunities{% endblock %}

{% block page_subtitle %}Join our team and make a difference{% endblock %}

{% block breadcrumb_items %}
<li>
    <div class="flex items-center">
        <i class="fas fa-chevron-right text-gray-400"></i>
        <a href="{% url 'vacancies_list' %}" class="ml-1 text-sm font-medium text-gray-700 hover:text-blue-600 md:ml-2">
            Vacancies
        </a>
    </div>
</li>
{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">
    <!-- Introduction -->
    <div class="mb-12">
        <div class="prose prose-lg max-w-none">
            <p class="text-lg text-gray-700">
                Join EIP Ethiopia and be part of a team dedicated to creating positive change in Ethiopian communities. We offer meaningful work, professional growth, and the opportunity to make a real impact.
            </p>
        </div>
    </div>

    <!-- Stats -->
    <div class="mb-12 bg-gradient-to-r from-blue-50 to-blue-100 rounded-2xl p-8">
        <div class="grid md:grid-cols-4 gap-8">
            <div class="text-center">
                <div class="text-4xl font-bold text-blue-600 mb-2">{{ active_vacancies }}</div>
                <p class="text-gray-700 font-medium">Current Openings</p>
            </div>
            <div class="text-center">
                <div class="text-4xl font-bold text-blue-600 mb-2">Ethiopia</div>
                <p class="text-gray-700 font-medium">Location</p>
            </div>
            <div class="text-center">
                <div class="text-4xl font-bold text-blue-600 mb-2">Various</div>
                <p class="text-gray-700 font-medium">Departments</p>
            </div>
            <div class="text-center">
                <div class="text-4xl font-bold text-blue-600 mb-2">Full-time</div>
                <p class="text-gray-700 font-medium">Contract Types</p>
            </div>
        </div>
    </div>

    <!-- Vacancies List -->
    <div class="mb-12">
        {% if vacancies %}
        <div class="space-y-6">
            {% for vacancy in vacancies %}
            <div class="bg-white rounded-xl shadow-lg overflow-hidden hover-lift animate-on-scroll">
                <div class="p-8">
                    <div class="flex flex-col md:flex-row md:items-start justify-between gap-4">
                        <div class="flex-grow">
                            <!-- Job Type Badge -->
                            <div class="mb-3">
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium 
                                    {% if vacancy.job_type == 'full-time' %}bg-blue-100 text-blue-800
                                    {% elif vacancy.job_type == 'part-time' %}bg-green-100 text-green-800
                                    {% elif vacancy.job_type == 'contract' %}bg-yellow-100 text-yellow-800
                                    {% else %}bg-purple-100 text-purple-800{% endif %}">
                                    <i class="fas 
                                        {% if vacancy.job_type == 'full-time' %}fa-briefcase
                                        {% elif vacancy.job_type == 'part-time' %}fa-clock
                                        {% elif vacancy.job_type == 'contract' %}fa-file-contract
                                        {% else %}fa-user-graduate{% endif %} mr-2"></i>
                                    {{ vacancy.get_job_type_display }}
                                </span>
                            </div>
                            
                            <!-- Title -->
                            <h3 class="text-2xl font-bold text-gray-800 mb-2">
                                <a href="{% url 'vacancy_detail' vacancy.slug %}" class="hover:text-blue-600">
                                    {{ vacancy.title }}
                                </a>
                            </h3>
                            
                            <!-- Location and Deadline -->
                            <div class="flex flex-wrap items-center gap-4 text-gray-600 mb-4">
                                <span class="inline-flex items-center">
                                    <i class="fas fa-map-marker-alt mr-2"></i>
                                    {{ vacancy.location }}
                                </span>
                                <span class="inline-flex items-center">
                                    <i class="far fa-clock mr-2"></i>
                                    Deadline: {{ vacancy.deadline|date:"F j, Y" }}
                                </span>
                            </div>
                            
                            <!-- Description Excerpt -->
                            <div class="prose max-w-none mb-4">
                                {{ vacancy.description|safe|truncatewords_html:50 }}
                            </div>
                        </div>
                        
                        <!-- Actions -->
                        <div class="flex-shrink-0">
                            <div class="space-y-3">
                                <a href="{% url 'vacancy_detail' vacancy.slug %}" 
                                   class="block w-full bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold text-center transition duration-300">
                                    View Details
                                </a>
                                <a href="{% url 'vacancy_detail' vacancy.slug %}#apply" 
                                   class="block w-full border-2 border-blue-600 text-blue-600 hover:bg-blue-50 px-6 py-3 rounded-lg font-semibold text-center transition duration-300">
                                    Apply Now
                                </a>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Days Remaining -->
                    <div class="mt-6 pt-6 border-t border-gray-100">
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-500">
                                Posted: {{ vacancy.created_date|date:"F j, Y" }}
                            </span>
                            {% with days_remaining=vacancy.deadline|timeuntil %}
                            <span class="text-sm font-medium 
                                {% if vacancy.deadline < today %}text-red-600
                                {% elif vacancy.deadline|timeuntil|slice:":2"|add:"0" <= 7 %}text-yellow-600
                                {% else %}text-green-600{% endif %}">
                                <i class="fas fa-hourglass-half mr-1"></i>
                                {% if vacancy.deadline < today %}
                                Application closed
                                {% else %}
                                {{ days_remaining }} remaining
                                {% endif %}
                            </span>
                            {% endwith %}
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <!-- Pagination -->
        {% include 'partials/pagination.html' %}
        
        {% else %}
        <div class="text-center py-12 bg-gray-50 rounded-xl">
            <i class="fas fa-briefcase text-5xl text-gray-400 mb-4"></i>
            <h3 class="text-xl font-semibold text-gray-600 mb-2">No Current Vacancies</h3>
            <p class="text-gray-500 mb-6">
                There are no current job openings. Please check back later or subscribe to our newsletter for updates.
            </p>
            <div class="space-x-4">
                <a href="{% url 'contact' %}" 
                   class="inline-flex items-center bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold transition duration-300">
                    <i class="fas fa-envelope mr-2"></i> Contact Us
                </a>
                <a href="#newsletter" 
                   class="inline-flex items-center border-2 border-blue-600 text-blue-600 hover:bg-blue-50 px-6 py-3 rounded-lg font-semibold transition duration-300">
                    <i class="fas fa-bell mr-2"></i> Get Notified
                </a>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Why Work With Us -->
    <div class="mb-12">
        <h2 class="text-2xl font-bold text-gray-800 mb-8 text-center">Why Work With EIP Ethiopia?</h2>
        <div class="grid md:grid-cols-3 gap-8">
            <div class="text-center">
                <div class="text-blue-600 text-4xl mb-4">
                    <i class="fas fa-heart"></i>
                </div>
                <h4 class="font-bold text-lg mb-3">Meaningful Impact</h4>
                <p class="text-gray-600">Contribute directly to sustainable community development and positive change.</p>
            </div>
            
            <div class="text-center">
                <div class="text-blue-600 text-4xl mb-4">
                    <i class="fas fa-users"></i>
                </div>
                <h4 class="font-bold text-lg mb-3">Collaborative Environment</h4>
                <p class="text-gray-600">Work with passionate professionals dedicated to making a difference.</p>
            </div>
            
            <div class="text-center">
                <div class="text-blue-600 text-4xl mb-4">
                    <i class="fas fa-chart-line"></i>
                </div>
                <h4 class="font-bold text-lg mb-3">Professional Growth</h4>
                <p class="text-gray-600">Access training and development opportunities to advance your career.</p>
            </div>
        </div>
    </div>

    <!-- Application Process -->
    <div class="bg-gray-50 rounded-2xl p-8 mb-12">
        <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Our Application Process</h2>
        <div class="grid md:grid-cols-4 gap-6">
            <div class="text-center">
                <div class="w-12 h-12 bg-blue-600 text-white rounded-full flex items-center justify-center mx-auto mb-4">
                    <span class="font-bold">1</span>
                </div>
                <h4 class="font-bold text-gray-800 mb-2">Submit Application</h4>
                <p class="text-gray-600 text-sm">Complete the online application form with your CV and cover letter.</p>
            </div>
            
            <div class="text-center">
                <div class="w-12 h-12 bg-blue-600 text-white rounded-full flex items-center justify-center mx-auto mb-4">
                    <span class="font-bold">2</span>
                </div>
                <h4 class="font-bold text-gray-800 mb-2">Review</h4>
                <p class="text-gray-600 text-sm">Our HR team reviews all applications against position requirements.</p>
            </div>
            
            <div class="text-center">
                <div class="w-12 h-12 bg-blue-600 text-white rounded-full flex items-center justify-center mx-auto mb-4">
                    <span class="font-bold">3</span>
                </div>
                <h4 class="font-bold text-gray-800 mb-2">Interviews</h4>
                <p class="text-gray-600 text-sm">Shortlisted candidates are invited for interviews (virtual or in-person).</p>
            </div>
            
            <div class="text-center">
                <div class="w-12 h-12 bg-blue-600 text-white rounded-full flex items-center justify-center mx-auto mb-4">
                    <span class="font-bold">4</span>
                </div>
                <h4 class="font-bold text-gray-800 mb-2">Offer</h4>
                <p class="text-gray-600 text-sm">Successful candidates receive a job offer and onboarding information.</p>
            </div>
        </div>
    </div>

    <!-- Newsletter Signup for Job Alerts -->
    <div id="newsletter" class="bg-gradient-to-r from-blue-600 to-blue-800 text-white rounded-2xl p-8">
        <div class="max-w-2xl mx-auto text-center">
            <h3 class="text-2xl font-bold mb-4">Get Job Alerts</h3>
            <p class="text-blue-100 mb-6">
                Subscribe to receive notifications when new positions matching your interests become available.
            </p>
            
            <form id="job-alert-form" class="flex max-w-md mx-auto">
                {% csrf_token %}
                <div class="flex-grow">
                    <input type="email" 
                           name="email" 
                           placeholder="Your email address" 
                           required
                           class="w-full px-4 py-3 rounded-l-lg text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <button type="submit" 
                        class="bg-blue-500 hover:bg-blue-400 text-white px-6 py-3 rounded-r-lg font-semibold transition duration-300">
                    Subscribe
                </button>
            </form>
            <p id="job-alert-message" class="mt-3 text-sm hidden"></p>
            <p class="text-xs text-blue-200 mt-4">
                We'll only send you job alerts. Unsubscribe at any time.
            </p>
        </div>
    </div>
</div>

<script>
// Job alert form submission
document.getElementById('job-alert-form')?.addEventListener('submit', async function(e) {
    e.preventDefault();
    const form = this;
    const messageEl = document.getElementById('job-alert-message');
    const submitBtn = form.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;
    
    // Show loading
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Subscribing...';
    submitBtn.disabled = true;
    
    try {
        const formData = new FormData(form);
        const response = await fetch('/api/subscribe/', {
            method: 'POST',
            body: formData,
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            }
        });
        
        const data = await response.json();
        
        if (response.ok) {
            messageEl.textContent = data.message || 'Subscribed to job alerts!';
            messageEl.className = 'mt-3 text-sm text-green-300';
            form.reset();
        } else {
            messageEl.textContent = data.error || 'Subscription failed. Please try again.';
            messageEl.className = 'mt-3 text-sm text-red-300';
        }
    } catch (error) {
        messageEl.textContent = 'Network error. Please try again.';
        messageEl.className = 'mt-3 text-sm text-red-300';
    } finally {
        messageEl.classList.remove('hidden');
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
        
        // Hide message after 5 seconds
        setTimeout(() => {
            messageEl.classList.add('hidden');
        }, 5000);
    }
});
</script>
{% endblock %}