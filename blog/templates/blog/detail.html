{% extends 'base.html' %}
{% load static %}

{% block title %}{{ post.title }} - EIP Ethiopia{% endblock %}

{% block meta_description %}{{ post.meta_description|default:post.excerpt }}{% endblock %}

{% block meta_keywords %}
    {% if post.meta_keywords %}{{ post.meta_keywords }}
    {% else %}{% for tag in post.tags.all %}{{ tag.name }}{% if not forloop.last %}, {% endif %}{% endfor %}{% endif %}
{% endblock %}

{% block og_title %}{{ post.og_title|default:post.title }}{% endblock %}

{% block og_description %}{{ post.og_description|default:post.excerpt }}{% endblock %}

{% block og_image %}
    {% if post.og_image %}{{ post.og_image.url }}
    {% elif post.featured_image %}{{ post.featured_image.url }}
    {% else %}{% static 'images/og-image.jpg' %}{% endif %}
{% endblock %}

{% block breadcrumb_items %}
    <li>
        <div class="flex items-center">
            <i class="fas fa-chevron-right text-gray-400"></i>
            <a href="{% if post.post_type == 'news' %}{% url 'blog_list' %}?type=news{% elif post.post_type == 'implementation' %}{% url 'blog_list' %}?type=implementation{% else %}{% url 'blog_list' %}{% endif %}"
               class="ml-1 text-sm font-medium text-gray-700 hover:text-blue-600 md:ml-2">
                {% if post.post_type == 'news' %}News
                {% elif post.post_type == 'implementation' %}Implementation
                {% else %}Blog{% endif %}
            </a>
        </div>
    </li>
    <li>
        <div class="flex items-center">
            <i class="fas fa-chevron-right text-gray-400"></i>
            <span class="ml-1 text-sm font-medium text-gray-500 md:ml-2">
                {{ post.title|truncatechars:30 }}
            </span>
        </div>
    </li>
{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
  <!-- Article Header -->
  <article class="bg-white rounded-xl shadow-lg overflow-hidden mb-8">
    {% if post.featured_image %}
    <div class="h-96 overflow-hidden">
      <img
        src="{{ post.featured_image.url }}"
        alt="{{ post.title }}"
        class="w-full h-full object-cover"
      />
    </div>
    {% endif %}

    <div class="p-8">
      <!-- Meta Information -->
      <div class="flex flex-wrap items-center justify-between mb-6">
        <div class="flex items-center space-x-4">
          <span
            class="inline-flex items-center px-3 py-1 text-sm font-semibold {% if post.post_type == 'news' %}bg-blue-100 text-blue-800{% else %}bg-green-100 text-green-800{% endif %} rounded-full"
          >
            {% if post.post_type == 'news' %}
            <i class="fas fa-newspaper mr-1"></i> News {% else %}
            <i class="fas fa-blog mr-1"></i> Blog {% endif %}
          </span>

          <span class="text-gray-500 text-sm">
            <i class="far fa-calendar mr-1"></i>
            {{ post.published_date|date:"F j, Y" }}
          </span>

          <span class="text-gray-500 text-sm">
            <i class="far fa-clock mr-1"></i>
            {{ post.published_date|timesince }} ago
          </span>
        </div>

        <div class="flex items-center space-x-4 mt-4 sm:mt-0">
          <span class="text-gray-500 text-sm">
            <i class="fas fa-eye mr-1"></i>
            {{ post.views }} views
          </span>

          <!-- Share buttons -->
          <div class="flex items-center space-x-2">
            <span class="text-gray-500 text-sm">Share:</span>
            <a
              href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri }}"
              target="_blank"
              class="text-blue-600 hover:text-blue-800"
            >
              <i class="fab fa-facebook-f"></i>
            </a>
            <a
              href="https://twitter.com/intent/tweet?url={{ request.build_absolute_uri }}&text={{ post.title }}"
              target="_blank"
              class="text-blue-400 hover:text-blue-600"
            >
              <i class="fab fa-twitter"></i>
            </a>
            <a
              href="https://www.linkedin.com/shareArticle?mini=true&url={{ request.build_absolute_uri }}&title={{ post.title }}"
              target="_blank"
              class="text-blue-700 hover:text-blue-900"
            >
              <i class="fab fa-linkedin-in"></i>
            </a>
          </div>
        </div>
      </div>

      <!-- Title -->
      <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-6">
        {{ post.title }}
      </h1>

      <!-- Author -->
      <!-- FIXED Author Section -->
<div class="flex items-center mb-8 pb-8 border-b">
    <div class="flex-shrink-0 mr-4">
        <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
            <i class="fas fa-user text-blue-600 text-xl"></i>
        </div>
    </div>
    <div>
        <h4 class="font-semibold text-gray-800">
            {% if post.author %}
                {{ post.author.get_full_name|default:post.author.username }}
            {% else %}
                EIP Ethiopia
            {% endif %}
        </h4>
        <p class="text-gray-500 text-sm">Author</p>
    </div>
</div>
      <!-- Content -->
      <div class="prose prose-lg max-w-none mb-8">{{ post.content|safe }}</div>

      <!-- Categories and Tags -->
      <div class="pt-8 border-t">
        {% if post.categories.exists %}
        <div class="mb-4">
          <h5 class="font-semibold text-gray-700 mb-2">Categories:</h5>
          <div class="flex flex-wrap gap-2">
            {% for category in post.categories.all %}
            <a
              href="{% url 'posts_by_category' category.slug %}"
              class="px-3 py-1 bg-blue-100 text-blue-800 text-sm rounded-full hover:bg-blue-200"
            >
              {{ category.name }}
            </a>
            {% endfor %}
          </div>
        </div>
        {% endif %} {% if post.tags.exists %}
        <div>
          <h5 class="font-semibold text-gray-700 mb-2">Tags:</h5>
          <div class="flex flex-wrap gap-2">
            {% for tag in post.tags.all %}
            <a
              href="{% url 'posts_by_tag' tag.slug %}"
              class="px-3 py-1 bg-gray-100 text-gray-700 text-sm rounded-full hover:bg-gray-200"
            >
              #{{ tag.name }}
            </a>
            {% endfor %}
          </div>
        </div>
        {% endif %}
      </div>
    </div>
  </article>

  <!-- Related Posts -->
  {% if related_posts %}
  <div class="mb-12">
    <h2 class="text-2xl font-bold text-gray-800 mb-6">Related Posts</h2>
    <div class="grid md:grid-cols-3 gap-6">
      {% for related in related_posts %}
      <div class="bg-white rounded-lg shadow-md overflow-hidden hover-lift">
        {% if related.featured_image %}
        <a href="{% url 'blog_detail' related.slug %}">
          <div class="h-40 overflow-hidden">
            <img
              src="{{ related.featured_image.url }}"
              alt="{{ related.title }}"
              class="w-full h-full object-cover transition-transform duration-500 hover:scale-110"
            />
          </div>
        </a>
        {% endif %}

        <div class="p-4">
          <h3 class="font-semibold text-gray-800 mb-2 line-clamp-2">
            <a
              href="{% url 'blog_detail' related.slug %}"
              class="hover:text-blue-600"
            >
              {{ related.title }}
            </a>
          </h3>
          <p class="text-gray-500 text-sm mb-3">
            {{ related.published_date|date:"M d, Y" }}
          </p>
          <a
            href="{% url 'blog_detail' related.slug %}"
            class="text-blue-600 hover:text-blue-800 text-sm font-medium inline-flex items-center"
          >
            Read More <i class="fas fa-arrow-right ml-1"></i>
          </a>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
  {% endif %}

  <!-- Navigation -->
  <div class="flex justify-between items-center pt-8 border-t">
    <a
      href="{% if post.post_type == 'news' %}{% url 'blog_list' %}?type=news{% else %}{% url 'blog_list' %}{% endif %}"
      class="text-blue-600 hover:text-blue-800 font-medium inline-flex items-center"
    >
      <i class="fas fa-arrow-left mr-2"></i> Back to 
      {% if post.post_type == 'news' %}News{% else %}Blog{% endif %}
    </a>

    <a
      href="{% url 'contact' %}"
      class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium inline-flex items-center"
    >
      <i class="fas fa-envelope mr-2"></i> Contact Us
    </a>
  </div>
</div>
{% endblock %}
